var D=(t,e,n)=>new Promise((o,i)=>{var a=r=>{try{s(n.next(r))}catch(d){i(d)}},c=r=>{try{s(n.throw(r))}catch(d){i(d)}},s=r=>r.done?o(r.value):Promise.resolve(r.value).then(a,c);s((n=n.apply(t,e)).next())});const pad=t=>String(t).padStart(2,"0");function parseEventDateTime(t,e,n){const[o,i,a]=t.split("-").map(Number),c=`${o}-${pad(i)}-${pad(a)}`,s=n||t,[r,d,u]=s.split("-").map(Number),m=`${r}-${pad(d)}-${pad(u)}`;if(!e){const v=new Date(`${c}T00:00:00`),g=new Date(`${m}T00:00:00`);return g.setDate(g.getDate()+1),{start:v,end:g,allDay:!0}}const p=v=>{const g=v.match(/(\d{1,2}):(\d{2})\s*(AM|PM)/i);if(!g)return null;let E=parseInt(g[1]);const S=parseInt(g[2]),y=g[3].toUpperCase();return y==="PM"&&E!==12&&(E+=12),y==="AM"&&E===12&&(E=0),{hours:E,minutes:S}},h=e.match(/(.+?)\s*-\s*(.+)/);let l,f;h?(l=p(h[1]),f=p(h[2])):(l=p(e),l&&(f={hours:l.hours+1,minutes:l.minutes})),l||(l={hours:12,minutes:0},f={hours:13,minutes:0}),f||(f={hours:l.hours+1,minutes:l.minutes});const T=`${pad(l.hours)}:${pad(l.minutes)}:00`,b=`${pad(f.hours)}:${pad(f.minutes)}:00`,x=new Date(`${c}T${T}`),I=new Date(`${m}T${b}`);return{start:x,end:I,allDay:!1}}function formatICSDate(t){return`${t.getFullYear()}${pad(t.getMonth()+1)}${pad(t.getDate())}T${pad(t.getHours())}${pad(t.getMinutes())}${pad(t.getSeconds())}`}function formatICSDateOnly(t){return`${t.getFullYear()}${pad(t.getMonth()+1)}${pad(t.getDate())}`}function generateGoogleCalendarUrl(t){const{start:e,end:n,allDay:o}=parseEventDateTime(t.date,t.time,t.endDate),i=new URLSearchParams({action:"TEMPLATE",text:t.title,dates:o?`${formatICSDateOnly(e)}/${formatICSDateOnly(n)}`:`${formatICSDate(e)}/${formatICSDate(n)}`,details:t.description||"",location:t.location||""});return o||i.set("ctz","America/New_York"),`https://calendar.google.com/calendar/render?${i.toString()}`}function generateOutlookCalendarUrl(t){const{start:e,end:n,allDay:o}=parseEventDateTime(t.date,t.time,t.endDate),i=s=>{const r=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0"),m=String(s.getHours()).padStart(2,"0"),p=String(s.getMinutes()).padStart(2,"0"),h=String(s.getSeconds()).padStart(2,"0");return`${r}-${d}-${u}T${m}:${p}:${h}`},a=s=>{const r=s.getFullYear(),d=String(s.getMonth()+1).padStart(2,"0"),u=String(s.getDate()).padStart(2,"0");return`${r}-${d}-${u}`};return`https://outlook.live.com/calendar/0/deeplink/compose?${new URLSearchParams({path:"/calendar/action/compose",rru:"addevent",subject:t.title,startdt:o?a(e):i(e),enddt:o?a(n):i(n),body:t.description||"",location:t.location||"",allday:o?"true":"false"}).toString()}`}function generateICSFile(t){const{start:e,end:n,allDay:o}=parseEventDateTime(t.date,t.time,t.endDate),i=c=>c?c.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n"):"",a=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Victory Baptist Church//Events//EN"];return o||a.push("BEGIN:VTIMEZONE","TZID:America/New_York","BEGIN:DAYLIGHT","TZOFFSETFROM:-0500","TZOFFSETTO:-0400","TZNAME:EDT","DTSTART:19700308T020000","RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=2SU","END:DAYLIGHT","BEGIN:STANDARD","TZOFFSETFROM:-0400","TZOFFSETTO:-0500","TZNAME:EST","DTSTART:19701101T020000","RRULE:FREQ=YEARLY;BYMONTH=11;BYDAY=1SU","END:STANDARD","END:VTIMEZONE"),a.push("BEGIN:VEVENT",`UID:${t.id||Date.now()}@victorybaptistchurch.com`,`DTSTAMP:${formatICSDate(new Date)}`),o?a.push(`DTSTART;VALUE=DATE:${formatICSDateOnly(e)}`,`DTEND;VALUE=DATE:${formatICSDateOnly(n)}`):a.push(`DTSTART;TZID=America/New_York:${formatICSDate(e)}`,`DTEND;TZID=America/New_York:${formatICSDate(n)}`),a.push(`SUMMARY:${i(t.title)}`,`DESCRIPTION:${i(t.description||"")}`),t.location&&a.push(`LOCATION:${i(t.location)}`),a.push("STATUS:CONFIRMED","END:VEVENT","END:VCALENDAR"),a.join(`\r
`)}function downloadICSFile(t){const e=generateICSFile(t),n=new Blob([e],{type:"text/calendar;charset=utf-8"}),o=URL.createObjectURL(n),i=document.createElement("a");i.href=o,i.download=`${t.title.replace(/[^a-z0-9]/gi,"_")}.ics`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}function generateCalendarIconsHtml(t){const e=JSON.stringify(t).replace(/'/g,"&#39;");return`
        <a href="#" data-event='${e}' class="calendar-icon google-calendar" title="Add to Google Calendar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M19 4h-1V2h-2v2H8V2H6v2H5C3.89 4 3.01 4.9 3.01 6L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM5 8V6h14v2H5zm7 6H7v-2h5v2zm4 0h-2v-2h2v2zm0 4h-2v-2h2v2zm-4 0H7v-2h5v2z" fill="#4285F4"/>
                <path d="M12 14H7v-2h5v2z" fill="#EA4335"/>
                <path d="M16 14h-2v-2h2v2z" fill="#FBBC04"/>
                <path d="M16 18h-2v-2h2v2z" fill="#34A853"/>
                <path d="M12 18H7v-2h5v2z" fill="#4285F4"/>
            </svg>
        </a>
        <a href="#" data-event='${e}' class="calendar-icon outlook-calendar" title="Add to Outlook">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M24 12.5v7.1c0 .8-.7 1.4-1.5 1.4H13v-9h11v.5z" fill="#0078D4"/>
                <path d="M13 3v9H2V4.5C2 3.7 2.7 3 3.5 3H13z" fill="#0078D4"/>
                <path d="M13 12H2v7.5c0 .8.7 1.5 1.5 1.5H13v-9z" fill="#0364B8"/>
                <path d="M24 4.5V12H13V3h9.5c.8 0 1.5.7 1.5 1.5z" fill="#28A8EA"/>
                <path d="M9.5 7C7.6 7 6 8.6 6 10.5S7.6 14 9.5 14s3.5-1.6 3.5-3.5S11.4 7 9.5 7zm0 5.5c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z" fill="white"/>
            </svg>
        </a>
        <a href="#" data-event='${e}' class="calendar-icon apple-calendar" title="Add to Apple Calendar">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
            </svg>
        </a>
    `}function attachCalendarListeners(){document.querySelectorAll(".google-calendar").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=JSON.parse(t.getAttribute("data-event")),o=generateGoogleCalendarUrl(n);window.open(o,"_blank")})}),document.querySelectorAll(".outlook-calendar").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=JSON.parse(t.getAttribute("data-event")),o=generateOutlookCalendarUrl(n);window.open(o,"_blank")})}),document.querySelectorAll(".apple-calendar").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault();const n=JSON.parse(t.getAttribute("data-event"));downloadICSFile(n)})})}class Lightbox{constructor(){this.lightbox=document.getElementById("lightbox"),this.lightboxImage=document.getElementById("lightbox-image"),this.lightboxCaption=document.getElementById("lightbox-caption"),this.lightboxCounter=document.getElementById("lightbox-counter"),this.closeBtn=this.lightbox.querySelector(".lightbox-close"),this.prevBtn=this.lightbox.querySelector(".lightbox-prev"),this.nextBtn=this.lightbox.querySelector(".lightbox-next"),this.photos=[],this.currentIndex=0,this.init()}init(){document.querySelectorAll(".photo-item").forEach((n,o)=>{const i=n.querySelector("img");i&&(this.photos.push({src:i.src,alt:i.alt||`Photo ${o+1}`}),n.addEventListener("click",()=>this.open(o)),n.setAttribute("tabindex","0"),n.setAttribute("role","button"),n.addEventListener("keydown",a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),this.open(o))}))}),this.closeBtn.addEventListener("click",()=>this.close()),this.prevBtn.addEventListener("click",()=>this.prev()),this.nextBtn.addEventListener("click",()=>this.next()),this.lightbox.addEventListener("click",n=>{n.target===this.lightbox&&this.close()}),document.addEventListener("keydown",n=>{if(this.lightbox.classList.contains("active"))switch(n.key){case"Escape":this.close();break;case"ArrowLeft":this.prev();break;case"ArrowRight":this.next();break}}),this.addTouchSupport()}open(e){this.currentIndex=e,this.updateImage(),this.lightbox.classList.add("active"),document.body.style.overflow="hidden",setTimeout(()=>{this.closeBtn.focus()},100)}close(){this.lightbox.classList.remove("active"),document.body.style.overflow="";const e=document.querySelectorAll(".photo-item");e[this.currentIndex]&&e[this.currentIndex].focus()}prev(){this.currentIndex=(this.currentIndex-1+this.photos.length)%this.photos.length,this.updateImage()}next(){this.currentIndex=(this.currentIndex+1)%this.photos.length,this.updateImage()}updateImage(){const e=this.photos[this.currentIndex];this.lightboxImage.style.opacity="0",setTimeout(()=>{this.lightboxImage.src=e.src,this.lightboxImage.alt=e.alt,this.lightboxCaption.textContent=e.alt,this.lightboxCounter.textContent=`${this.currentIndex+1} / ${this.photos.length}`,this.lightboxImage.style.opacity="1"},150)}addTouchSupport(){let e=0,n=0;this.lightbox.addEventListener("touchstart",o=>{e=o.changedTouches[0].screenX},{passive:!0}),this.lightbox.addEventListener("touchend",o=>{n=o.changedTouches[0].screenX,this.handleSwipe()},{passive:!0}),this.handleSwipe=()=>{const i=e-n;Math.abs(i)>50&&(i>0?this.next():this.prev())}}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{document.getElementById("lightbox")&&!window.location.pathname.includes("/events/")&&new Lightbox}):document.getElementById("lightbox")&&!window.location.pathname.includes("/events/")&&new Lightbox,window.Lightbox=Lightbox;function loadEventDetail(){return D(this,null,function*(){const t=getQueryParam("id");if(!t){showEventError();return}const n=yield fetch(`data/events/${t}.json`);if(!n.ok){showEventError();return}const o=yield n.json();populateEventDetails(o)})}function populateEventDetails(t){const e=`${t.title} - Victory Baptist Church Kittanning`;document.title=e;const n=window.location.href,o=document.getElementById("meta-description");o&&o.setAttribute("content",t.description);const i=document.getElementById("meta-og-title");i&&i.setAttribute("content",e);const a=document.getElementById("meta-og-description");a&&a.setAttribute("content",t.description);const c=document.getElementById("meta-og-url");c&&c.setAttribute("content",n);const s=document.getElementById("meta-canonical");s&&s.setAttribute("href",n);const r=document.getElementById("breadcrumb-title");r&&(r.textContent=t.title);const d=document.getElementById("event-title");d&&(d.textContent=t.title);const u=document.getElementById("event-meta");if(u){const h=t.endDate?formatDateRange(t.date,t.endDate):formatEventDate(t.date);u.innerHTML=`
            <span class="event-detail-date">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                ${h}
            </span>
            ${t.time?`
            <span class="event-detail-time">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                ${t.time}
            </span>
            `:""}
            <span class="event-detail-location">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(t.location)}" target="_blank" rel="noopener noreferrer">${t.location}</a>
            </span>
        `}const m=document.getElementById("event-description");m&&(m.textContent=t.description);const p=document.getElementById("event-info");if(p){const h=getCategoryClass(t.category),l=getCategoryName(t.category);p.innerHTML=`
            <div class="info-item">
                <strong>Category:</strong>
                <span class="event-category ${h}">${l}</span>
            </div>
            <div class="info-item">
                <strong>Contact:</strong>
                <span>${t.contactName||"Church Office"}</span>
            </div>
        `}if(t.photos&&t.photos.length>0)loadEventPhotos(t.photos);else{const h=document.querySelector(".event-photos-section");h&&(h.style.display="none")}renderCalendarOptions(t)}let allPhotos=[],currentPhotoPage=1;const photosPerPage=10;function loadEventPhotos(t){allPhotos=t,currentPhotoPage=1,renderPhotoPage(),renderPhotoPagination()}function renderPhotoPage(){const t=document.getElementById("photoGrid");if(!t)return;t.innerHTML="";const e=(currentPhotoPage-1)*photosPerPage,n=Math.min(e+photosPerPage,allPhotos.length);allPhotos.slice(e,n).forEach((i,a)=>{const c=e+a,s=document.createElement("div");s.className="photo-item",s.setAttribute("data-index",c.toString());const r=document.createElement("img");r.src=i.src||i,r.alt=i.alt||`Event photo ${c+1}`,r.loading="lazy",s.appendChild(r),t.appendChild(s)}),window.Lightbox&&setTimeout(()=>{window.lightboxInstance=new window.Lightbox},100)}function renderPhotoPagination(){const t=Math.ceil(allPhotos.length/photosPerPage);if(t<=1)return;const e=document.querySelector(".event-photos-section");if(!e)return;const n=e.querySelector(".photo-pagination");n&&n.remove();const o=document.createElement("div");o.className="photo-pagination";const i=document.createElement("button");i.className="photo-page-btn",i.innerHTML="\u2190 Previous",i.disabled=currentPhotoPage===1,i.addEventListener("click",()=>{currentPhotoPage>1&&(currentPhotoPage--,renderPhotoPage(),renderPhotoPagination(),scrollToPhotos())}),o.appendChild(i);const a=document.createElement("span");a.className="photo-page-info",a.textContent=`${currentPhotoPage} of ${t}`,o.appendChild(a);const c=document.createElement("button");c.className="photo-page-btn",c.innerHTML="Next \u2192",c.disabled=currentPhotoPage===t,c.addEventListener("click",()=>{currentPhotoPage<t&&(currentPhotoPage++,renderPhotoPage(),renderPhotoPagination(),scrollToPhotos())}),o.appendChild(c),e.appendChild(o)}function scrollToPhotos(){const t=document.querySelector(".event-photos-section");t&&t.scrollIntoView({behavior:"smooth",block:"start"})}function renderCalendarOptions(t){const e=document.getElementById("eventCalendarSection");if(!e)return;const n=e.querySelector(".calendar-icons");n&&(n.innerHTML=generateCalendarIconsHtml(t),attachCalendarListeners())}function showEventError(){const t=document.getElementById("event-title"),e=document.getElementById("event-description"),n=document.getElementById("event-meta"),o=document.getElementById("event-info");t&&(t.textContent="Event Not Found"),e&&(e.innerHTML='Sorry, we could not load the event details. Please <a href="../../events.html">return to the events page</a>.'),n&&(n.innerHTML=""),o&&(o.innerHTML="<p>Event information unavailable.</p>")}
